#/usr/bin/python
import sys,os
import collections
import subprocess
from subprocess import *
from ROOT import *
from array import array

fileList = []

nFile = len(fileList)

runList = [28103, 28105, 28110, 28119, 28123, 28132, 28137, 28147, 28160, 28164, 28173, 28188, 28192, 28193, 28203, 28208, 28218, 28222, 28225, 28234, 28239, 28248, 28252, 28261, 28266, 28275, 28279, 28288, 28294, 28295, 28310, 28314, 28323, 28325, 28330, 28331, 28343, 28348, 28357, 28362, 28363, 28372, 28374, 28375, 28379, 28381, 28383, 28393, 28398, 28409, 28413, 28422, 28427, 28436, 28440, 28449, 28454, 28464, 28468, 28472, 28481, 28486, 28487, 28512, 28516, 28525, 28530, 28545, 28549, 28565, 28570, 28579, 28583, 28593, 28595, 28608, 28624, 28632, 28637, 28655, 28659, 28660, 28670, 28676, 28685, 28689, 28702, 28708, 28730, 28734, 28743, 28748, 28758, 28763, 28786, 28795, 28800, 28809, 28813, 28815, 28824, 28829, 28838, 28844, 28847, 28849, 28860, 28872, 28876, 28889, 28894, 28902, 28906, 28914, 28918, 28921, 28929, 28933, 28939, 28943, 28953, 28961, 28965, 28973, 28977, 28985, 28989, 28997, 29001, 29010, 29014, 29025, 29029, 29037, 29041, 29049, 29053, 29067, 29071, 29080, 29084, 29085, 29094, 29098, 29110, 29114, 29124, 29128, 29137, 29141, 29163, 29167, 29178, 29182, 29188, 29192, 29193, 29197, 29201, 29205, 29209, 29213, 29217, 29221, 29225, 29233, 29237, 29241, 29246, 29250, 29254, 29255, 29259, 29263, 29268, 29272, 29276, 29280, 29284, 29288, 29292, 29296, 29300, 29304, 29308, 29309, 29313, 29317, 29321, 29325, 29329, 29333, 29337, 29341, 29345, 29349, 29353, 29357, 29361, 29365, 29369, 29373, 29377, 29381, 29389, 29393, 29397, 29401, 29407, 29411, 29415, 29419, 29423, 29427, 29431, 29439, 29443, 29447, 29451, 29455, 29459, 29463, 29468, 29472, 29476, 29480, 29484, 29488, 29492, 29493, 29497, 29501, 29505, 29509, 29513, 29517, 29521, 29525, 29529, 29533, 29537, 29538, 29542, 29549, 29551, 29555, 29559, 29563, 29567, 29571, 29575, 29579, 29581, 29582, 29586, 29590, 29595, 29597, 29598, 29602, 29606, 29610, 29614, 29618, 29622, 29626, 29630, 29634, 29638, 29642, 29646, 29648, 29652, 29658, 29665, 29673, 29676, 29691, 29696, 29700, 29704, 29708, 29712, 29716, 29720, 29724, 29728, 29732, 29736, 29740, 29744, 29748, 29752, 29759, 29763, 29767, 29771, 29775, 29779, 29783, 29787, 29791, 29795, 29799, 29803, 29807, 29811, 29815, 29819, 29823, 29827, 29831, 29835, 29842, 29846, 29847, 29848, 29851, 29856, 29857, 29861, 29869, 29873, 29877, 29881, 29883, 29884, 29888, 29892, 29893, 29897, 29901, 29905, 29910, 29920, 29924, 29925, 29929, 29930, 29934, 29938, 29942, 29946, 29950, 29954, 29958, 29978, 29984, 29992, 30005, 30026, 30040, 30041, 30042, 30043, 30044, 30057, 30068, 30078, 30088, 30089, 30097, 30098, 30107, 30117, 30130, 30131, 30132, 30133, 30134, 30135, 30137, 30146, 30154, 30162, 30175, 30176, 30192, 30201, 30209, 30213, 30216, 30217, 30221, 30243, 30251, 30260, 30262, 30272, 30280, 30289, 30297, 30306, 30314, 30322, 30323, 30337, 30338, 30339, 30347, 30361, 30372, 30383, 30392, 30400, 30417, 30419, 30433, 30443, 30452, 30453, 30467, 30476, 30485, 30494, 30495, 30504, 30507, 30513, 30522, 30532, 30543, 30544, 30553, 30557, 30572, 30581, 30590, 30599, 30609, 30618, 30627, 30636, 30646, 30655, 30656, 30658, 30676, 30690, 30699, 30700, 30712, 30721, 30730, 30731, 30732, 30733, 30735, 30736, 30751, 30760, 30769, 30778, 30779, 30789, 30799, 30808, 30819, 30832, 30841, 30850, 30865, 30876, 30889, 30898, 30909, 30922, 30943, 30953, 30969, 30978, 30987, 31002, 31003, 31012, 31020, 31029, 31038, 31057, 31067, 31076, 31094, 31103, 31118, 31130, 31132, 31141, 31150, 31170, 31171, 31172, 31186, 31196, 31205, 31206, 31216, 31228, 31241, 31250, 31251, 31260, 31279, 31291, 31301, 31302, 31304, 31313, 31322, 31331, 31334, 31343, 31355, 31365, 31374, 31386, 31395, 31409, 31410, 31411, 31420, 31429, 31452, 31464, 31480, 31489, 31499, 31511, 31533, 31542, 31552, 31561, 31577, 31586, 31595, 31606, 31619, 31620, 31622, 31633, 31634, 31636, 31638, 31647, 31656, 31666, 31675, 31676, 31688, 31697, 31706, 31715, 31728, 31733, 31737, 31747, 31752, 31761, 31770, 31779, 31780, 31794, 31797, 31798, 31813, 31822, 31831, 31840, 31843, 31844, 31858, 31871, 31874, 31877, 31886, 31895, 31908, 31922, 31923, 31936, 31945, 31949, 31953, 31957, 31959, 31970, 31987, 31998, 32008, 32026, 32035, 32046, 32056, 32065, 32076, 32086, 32088, 32101, 32110, 32119, 32121, 32139, 32148, 32149, 32158, 32167, 32169, 32171, 32173, 32175]

### events from livetime DB
totalEvents = [12024842,18310929,28785634,29677894,29566535,26471531,32767406,36879070,29194746,29708802,29262888,30067122,13278211,15054376,30387755,25264673,29021417,26987845,4664713,30050340,30759062,30115290,30005008,29965735,29288236,23421810,29629678,29888882,4855411,24691397,35021599,29964421,12636375,17772849,2948019,25967754,28556151,36198469,28892203,15074613,13679327,11270674,11789036,5936461,12330960,1267013,13229130,30780804,28149998,28891651,29271130,33396547,26200733,31766517,28272781,29098825,29703857,27910558,7582416,21456506,30014226,23969380,525554,30536415,37922984,30967312,28046288,28045544,36297466,28999352,31133962,26018138,29478168,29435354,24014974,26617796,10386785,26661839,32547665,28370793,1921969,28477365,28740359,36657079,25504713,29352225,27563166,26877859,3666458,24157316,29324789,28831134,28969284,30675972,18193272,29322865,28751952,23517606,6657051,22355118,28543571,28441818,27203770,2959576,12453017,13219087,29976808,34893726,28265647,34324776,31543372,32912958,34007389,35520351,32731472,1455922,37091311,35952860,8954858,13984262,31556713,40821841,49865859,43682773,41442102,43703786,41834729,44471078,45441162,46395621,48468794,54144175,41259119,62168097,39160447,50035206,52857841,60882047,47520807,58102468,27947904,28125147,58501586,46540457,63837960,58079916,61681811,53218316,60278304,64677875,59184631,65964928,31149288,37088770,63796320,17854243,48718591,71813441,70281351,65618627,70577215,66205537,74052531,70717806,76258053,58735838,66275501,64917549,71946451,71031366,18209715,51762576,72546666,73464054,72272181,73954104,74542033,77878194,75284178,71156462,69411017,79556156,72581826,76542811,74703476,72538,75156159,74173935,81850921,69962153,75509841,75989109,76287111,74869885,78249918,71397629,77292405,84127513,70093623,76069953,78955535,75417806,89796397,72087222,85243733,69398842,77743531,78987148,74980523,78061639,76358031,99426586,56349777,77616944,80082309,77863345,76368774,83912818,76537728,74379045,80359428,79126351,77538599,78855947,78786271,75475397,82587607,78858758,57209190,23065880,78278497,83249403,98591933,59352573,75891576,79801883,79168153,81624781,80714206,78757374,73316874,7129615,33313675,19231355,7474394,79233453,80314221,79082541,80215518,79491051,88199785,3601248,64567626,4052284,76528682,-1,34785128,88039,60827630,59772227,79814515,77482170,84393955,81378794,85840442,76960830,83650857,84122890,74537995,81360002,53316061,17744712,63411881,3790831,1743549,81919171,1878535,68355068,79804724,81165646,80546515,79613900,80687134,81997178,85521741,75129492,80827954,81265597,80755925,97961756,65227913,81178303,80816380,84113348,77897419,87604280,74042966,82498678,82571160,81365729,82464337,82508687,82275051,85738634,78112519,84302350,80982011,88121088,77992325,83859618,81886491,83555265,50192508,22472943,18523132,6154478,3775863,47549143,9491742,72808515,85004657,77042042,83570444,83288786,11706301,1090013,84189280,70206977, 1602396, 88484532, 74892490, 83132707, 85379689, 63592864, 116673735, 91571275, 2972055, 9587122, 6966176, 108901592, 137814084, 143233318, 158158084, 113390174, 141059645, 149123259, 143344611, 174427044, 146646913, 137805717, 116059632, 7824027, 0, 0, 0, 138012760, 145675820, 143837095, 149532385, 142660428, 27178343, 14529961, 135575192, 156940111, 133365697, 1739780, 832883, 1570675, 217296, 92848, 91451881, 11764805, 110305935, 78810952, 100071365, 0, 80341073, 74859692, 92100419, 13470174, 17001064, 3735201, 6422356, 40511154, 82438999, 85350645, 11255939, 94071327, 78622012, 84853824, 93591807, 85089133, 83892427, 91558403, 60786079, 30695097, 37260803, 43908102, 5167441, 88475945, 86381104, 72297759, 102445089, 88170295, 2675032, 11030755, 77002428, 81705217, 62617882, 12251411, 53864786, 53887269, 51650150, 50539449, 6485992, 32412424, 26862272, 14926, 6053122, 30885092, 28629881, 1530616, 28886841, 6996871, 20426951, 29063826, 27883759, 32445480, 29674500, 28131261, 27196893, 20547455, 7298168, 27563810, 5860716, 0, 23654233, 29454759, 24100116, 25261778, 2381173, 23658856, 27312987, 15628514, 1654501, 268356, 0, 137482, 8422923, 26224859, 27139168, 26756032, 621917, 26291373, 21742960, 30154238, 22049908, 23860266, 25298704, 26877249, 26694708, 25271394, 27291774, 21302206, 27044620, 24461993, 28624385, 24274026, 28528586, 23449238, 26861929, 28443961, 9147777, 953716, 26673624, 27024306, 20560228, 19806973, 26878592, 23088572, 25932930, 25166980, 28549339, 25313725, 474050, 23942869, 25161673, 26772733, 25830856, 1606005, 112247, 23826626, 24461524, 1440734, 27108538, 26694936, 25475913, 26786059, 26108229, 7389888, 27107380, 26765528, 25292452, 206405, 451553, 25790894, 31867583, 26564529, 5092438, 23576876, 25170015, 26741047, 36111443, 28939616, 26830985, 25180434, 5363794, 20989763, 2216411, 26416326, 27635280, 23247886, 17309370, 27251908, 26862724, 25813016, 25396858, 26344193, 27021001, 26745266, 20759013, 26218456, 26630061, 21596761, 25455985, 12817492, 0, 14154402, 1328786, 124035, 12192993, 13480876, 26114936, 17617377, 26444806, 9110749, 17104465, 26270726, 26414782, 28030847, 24547807, 26838700, 26999649, 26796751, 89143, 23063873, 18450559, 26406984, 1168883, 28605141, 21109620, 650578, 2835119, 27038129, 26405804, 24492729, 6574543, 0, 7811461, 24973348, 11814, 1254249, 22317022, 26084544, 32259511, 22589408, 215100, 24886360, 25775376, 25952587, 21497704, 24093565, 29391152, 15193615, 12220655, 26380537, 37110896, 26428711, 25806939, 27134485, 790843, 21262170, 25887617, 27619036, 2778975, 22377850, 29438100, 27062169, 10551717, 4925189, 24307691, 3590971, 27979820, 26324179, 16169354, 1749842, 2472275, 2819233, 950712]

## muon-corrected livetime
livetimeList = [33562.2,51166.7,80554.3,82929.4,82706,73977.5,91422.5,102921,82727.9,84241.9,83011.8,84856.2,37543.3,42662.2,86068.1,71545.9,81955.7,76137,13144.8,84796.8,86912.7,84832.1,84456.4,84567.6,82621.2,65775.2,82917.7,83391.6,13550.4,69157.3,97976.1,83849.4,35333.2,49740,8242.77,72731,80154.1,101548,81105.3,42269.8,38520.8,31747.3,33233.2,16737.9,34726.6,3552.17,37236.6,86581.7,79217.8,80981.9,81907.9,93353.4,73278.8,88788.7,79075,81333.6,83239.7,78085.2,21203,59867.8,83806.3,66983.8,1466.59,85700.5,107079,87512,79275,79737.2,103215,82179.1,88141.2,73621.4,83467.9,83246.2,68020.6,75458.5,29596,76061.5,92863.4,80712.5,5483.64,80960.5,81830.4,104177,72406.1,83168.9,78084.5,76079.3,10423.1,69218.3,83800.5,82275.2,82719.1,87651.6,51708.9,83852.8,82276.1,67379.8,19081.8,63646,81088.6,80787.7,77165.1,8456.76,35769.3,37971.4,82573,93710.8,65470.5,86210.3,78620.4,80621.7,82407.2,84440.6,77023.9,3398.41,84988.4,81414.4,19774.4,30846.6,67559,85397.6,102815,87869.7,82162.1,84618.4,79997.8,82715.1,83363.2,82975.5,85584.6,93035.4,70124.9,102780,63816.7,79527.4,83096.3,94120.3,72530.2,86771.9,41276.5,41280,84342.8,66392.9,89384.1,80410.2,83527,71358.1,79204.5,84187.8,75446.9,83306.6,38871.4,46077.1,77999.4,21765.6,59180.2,86647.8,84210.1,78054.8,83457.5,77850,86551.6,82243.9,88260,67253.1,75600.6,73803.5,81940.4,80560.2,20631.4,58528.2,81850.7,82684.4,81079.7,82650.9,83175.3,86581.1,83475.3,78689.9,76633.9,87609,79858.8,84071,81892.9,79.3917,82209.5,80933.9,89163.3,76062.7,81963,82344.6,82454.6,80872.1,84518.1,76973.7,83272.1,90525.1,75275.3,81583.7,84532.6,80705.1,95992.8,76902.6,90813,73849.6,82718.4,83972.4,79629.3,82799.1,80901.5,105166,59515.5,81907.5,84397.4,82047.5,80408.4,88346.7,80501.7,78166.3,84369.3,83059.1,81236.9,82555.7,82438.6,78911.9,86332.2,82228.9,59685.4,24056.6,81495.4,86629.4,102363,61659.8,78723.4,82752.2,82126.9,84585.5,83565.3,81470.5,75763.3,7369.67,34452.3,19877.7,7729.37,81943.4,82924,81638.2,82770.9,81887,90792.6,3710.77,65826.9,4129.86,77988.9,-0.998378,35564.5,89.0614,62176,61080.8,81510.8,79016,85815,82682.7,87202.1,78024.4,84717.4,85056.8,75316.1,82145.4,53843.3,17864.9,63955.2,51759.7,23806.8,83177.3,1928.53,69993.5,81768.1,83152.2,82476.2,81389.8,82383.8,83614.4,87116.6,76407.7,82135.6,82427.3,81681.6,99179.4,65981.6,81982.2,81557.7,84778.2,78334.7,88092.1,74341.4,82788.8,82763.1,81620.7,82657.7,82620.9,82420,85706.7,77997.1,84094.2,80595.8,87643.6,77556.3,83324.4,81242.5,82813.7,49743.5,22243.3,18344.9,6096.4,3739.62,47076.7,9388.44,72037.8,84124.4,76263.3,82681.5,82357.2,11574.2,1079.33,83164.9,69493.6,1633.91,87135,73415.5,81398.1,83619,61735.2,86116.3,57897,1869.59,5889.29,4135,62352.1,78927.4,82047.5,90560.1,64884.9,80612.8,85100.1,81563.9,99162.8,83292.6,77934.2,65297.7,4376.94,-0.998398,-0.998398,-0.998398,77123.9,81218.6,78976.7,81035.9,79842.3,16229,9022.13,84037.7,96992.5,82359,1223.83,587.608,1106.75,152.62,65.5147,64402.4,8286.52,77944.1,55919.5,84043.1,-0.998398,78369.2,74106.9,92240.3,13603.8,17184.2,4035.81,6936.64,43622.8,83990.3,85885.5,11230.8,93684.2,77749.9,83324,91326.7,82499.2,80909.4,87874.6,58042.4,29239.3,35331.2,41612.9,4894.13,83331.4,80898.8,67274,94870.5,81645.9,2547.92,10283.5,73329.4,83008.9,71232.8,15426.9,70318.4,83312.4,92057.3,101415,13977.9,71344.2,61946.2,2.00352,14272.4,75748.8,74866.3,4111.82,78115.2,19339.3,56286.3,82133.8,80008,94536.4,87669.6,83925.7,81744.7,62394.9,21943.2,83095,17714.3,-0.998398,71308.7,88991.8,73088.6,77065.7,7243.32,72370.8,83841.8,47860.3,5070.23,826.497,-0.998398,421.752,25834.8,80918,83923.7,82698.8,1917.54,81483.2,67413.3,93703.2,68538.6,74455,78631.8,83606.7,83136.3,78020.6,84146.3,66158.1,84624.4,76824.5,88179.1,74614.2,87823.2,72118.9,82887.5,87531.3,28606.1,2977.54,83359.3,84577.8,64160.8,61862.8,83888.3,72147.5,81036.7,79323.4,89181.2,79299.9,1481.39,74587.4,78607.3,83610.9,80443,4994,350.646,74367.7,76285.1,4500.37,84405.3,83069.9,79430.2,83539.5,81583.3,23124.6,84634.3,83773.7,78992.3,644.341,1410.32,80525.4,99462.5,82664.2,15921.6,73555.5,79320.1,83462,113021,90315.6,83768.5,78587,16847.8,65733,6928.7,82435.4,86504.1,72645.4,54685.5,85829.9,84373.9,81021.1,79590.1,82923.8,84652.2,83805,65201.9,81517.9,83101.7,67382.6,79427.8,40107.3,-0.998398,44308.4,3807.79,392.928,38037.4,42678.9,82833.5,55914.9,84165.5,28971.5,54452.9,83508.2,83865.4,89099.3,78193.4,84816.2,85408.7,84903.6,282.282,73262.7,58517.2,83490.3,3700.12,90475.8,67437.8,2075.08,9097.7,85912.3,83901.8,77986.6,20804.2,-0.998398,24938.8,82220.7,273.974,3952.62,70696.7,82917.5,102239,71811.4,696.547,80650,83353.6,84056.1,69708.4,77842,94897.7,48948.4,39549.7,85555.8,120602,85709.8,82341.3,86798.2,2529.34,68120,82761,88313.9,8902.8,71087.5,93708.8,86164,33461,15719.3,77509,11394.2,88916.9,83667.3,52502.4,5698.86,8042.65,9136.95,3139.95]

print len(runList), "runs", len(totalEvents), "eventRuns", len(livetimeList), "liveTimeRuns"

hrates = TH1F("hrates", "", 1468, 30681, 32149)

print nFile, "files", len(livetimeList), "runLists", len(runList)

nRuns = len(runList)
array_rates = array('d')
array_runs = array('d')

stable_data = []

for i in range(nRuns):
    counts = totalEvents[i] 
    time = livetimeList[i]
    # print time, counts
    rates = counts/time
    run = runList[i]
    array_rates.append(rates)
    array_runs.append(run)
    if rates<100:
        print run, rates
    else:
        stable_data.append([run, time])



### check for special periods:
period_time1 = 0
period_time2 = 0
for item in stable_data:
    if item[0]>=28103 and item[0]<=28487: # calC
        period_time1 += item[1]
    if item[0]>=28512 and item[0]<=28849: # calF
        period_time2 += item[1]

print period_time1/3600/24, "days"

print period_time2/3600/24, "days"


print nRuns, "runs, livetime = ", sum(livetimeList)/3600/24, "days"
#print array_runs
#print array_rates

gRates = TGraph(nRuns, array_runs, array_rates)

gRates.SetLineColor( 2 )
gRates.SetLineWidth( 4 )
gRates.SetMarkerColor( 4 )
gRates.SetMarkerStyle( 21 )
gRates.SetTitle( 'vacuum runs' )
gRates.GetXaxis().SetTitle( 'run number' )
gRates.GetYaxis().SetTitle( 'counts/sec' )
gRates.Draw( 'AP' )

raw_input()
